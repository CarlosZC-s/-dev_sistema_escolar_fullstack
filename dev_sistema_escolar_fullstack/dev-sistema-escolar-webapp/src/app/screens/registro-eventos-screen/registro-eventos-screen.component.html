<div class="full-screen-wrapper">
  <div class="card-container">

    <div class="card-header-custom">
      <div class="header-text">
        <h1 class="title-custom">{{ editar ? 'Editar Evento' : 'Registrar Evento' }}</h1>
        <p class="subtitle-custom">Ingresa los detalles del evento académico para publicarlo</p>
      </div>
      <button mat-icon-button class="clean-back-btn" (click)="regresar()">
        <mat-icon>arrow_back</mat-icon>
      </button>
    </div>

    <div class="card-body-custom">

      <mat-form-field class="w-100 mb-1" appearance="fill">
        <mat-label>Nombre del evento</mat-label>
        <input matInput [(ngModel)]="evento.nombre_evento" (keypress)="validarNombre($event)"
          placeholder="Ej. Semana de Ciberseguridad">
        <mat-icon matSuffix>title</mat-icon>
      </mat-form-field>
      <div class="error-msg" *ngIf="errors.nombre_evento">{{ errors.nombre_evento }}</div>

      <div class="ticket-row-highlight mb-4">
        <div class="row align-items-center">

          <div class="col-md-4 border-right-dashed">
            <mat-form-field class="w-100 compact-input" appearance="fill">
              <mat-label>Fecha de realización</mat-label>
              <input matInput [min]="minDate" [matDatepicker]="picker" [(ngModel)]="evento.fecha"
                (dateChange)="changeFecha($event)" readonly>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
            <div class="error-msg" *ngIf="errors.fecha">{{ errors.fecha }}</div>
          </div>

          <div class="col-md-4">
            <mat-form-field class="w-100 compact-input" appearance="fill">
              <mat-label>Hora Inicio</mat-label>
              <input matInput [ngxTimepicker]="pickerInicio" [(ngModel)]="evento.hora_inicio" readonly>
              <ngx-material-timepicker #pickerInicio [format]="24"></ngx-material-timepicker>
              <mat-icon matSuffix>schedule</mat-icon>
            </mat-form-field>
            <div class="error-msg" *ngIf="errors.hora_inicio">{{ errors.hora_inicio }}</div>
          </div>

          <div class="col-md-4">
            <mat-form-field class="w-100 compact-input" appearance="fill">
              <mat-label>Hora Fin</mat-label>
              <input matInput [ngxTimepicker]="pickerFin" [(ngModel)]="evento.hora_fin" readonly>
              <ngx-material-timepicker #pickerFin [format]="24"></ngx-material-timepicker>
              <mat-icon matSuffix>schedule</mat-icon>
            </mat-form-field>
            <div class="error-msg" *ngIf="errors.hora_fin">{{ errors.hora_fin }}</div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-2">
          <mat-form-field class="w-100" appearance="fill">
            <mat-label>Tipo de evento</mat-label>
            <mat-select [(ngModel)]="evento.tipo_evento">
              <mat-option *ngFor="let tipo of tipos_evento" [value]="tipo.value">
                {{ tipo.viewValue }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <div class="error-msg" *ngIf="errors.tipo_evento">{{ errors.tipo_evento }}</div>
        </div>

        <div class="col-md-6 mb-2">
          <mat-form-field class="w-100" appearance="fill">
            <mat-label>Responsable</mat-label>
            <mat-select [(ngModel)]="evento.responsable">
              <mat-option *ngFor="let resp of lista_responsables" [value]="resp.id">
                {{ resp.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <div class="error-msg" *ngIf="errors.responsable">{{ errors.responsable }}</div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-8 mb-2">
          <mat-form-field class="w-100" appearance="fill">
            <mat-label>Lugar / Ubicación</mat-label>
            <input matInput [(ngModel)]="evento.lugar" (keypress)="validarLugar($event)" placeholder="Ej. Auditorio 1">
            <mat-icon matSuffix>place</mat-icon>
          </mat-form-field>
          <div class="error-msg" *ngIf="errors.lugar">{{ errors.lugar }}</div>
        </div>
        <div class="col-md-4 mb-2">
          <mat-form-field class="w-100" appearance="fill">
            <mat-label>Cupo máximo</mat-label>
            <input matInput type="number" [(ngModel)]="evento.cupo_maximo" (keypress)="validarCupo($event)" min="1"
              onpaste="return false">
            <mat-icon matSuffix>group</mat-icon>
          </mat-form-field>
          <div class="error-msg" *ngIf="errors.cupo_maximo">{{ errors.cupo_maximo }}</div>
        </div>
      </div>

      <div class="audience-section mb-3 mt-2">
        <span class="audience-label">Dirigido a:</span>
        <div class="d-flex gap-3 flex-wrap">
          <mat-checkbox *ngFor="let pub of publico_options" [checked]="revisarSeleccion(pub.value)" [value]="pub.value"
            (change)="checkboxChange($event)" color="primary">
            {{ pub.viewValue }}
          </mat-checkbox>
        </div>
        <div class="error-msg" *ngIf="errors.publico_objetivo" style="margin-top: 8px;">
          {{ errors.publico_objetivo }}
        </div>
      </div>

      <div class="row mb-2" *ngIf="isEstudianteSelected()">
        <div class="col-12">
          <mat-form-field class="w-100" appearance="fill">
            <mat-label>Programa Educativo</mat-label>
            <mat-select [(ngModel)]="evento.programa_educativo">
              <mat-option *ngFor="let prog of programas" [value]="prog.value">
                {{ prog.viewValue }}
              </mat-option>
            </mat-select>
            <mat-icon matSuffix>school</mat-icon>
          </mat-form-field>
          <div class="error-msg" *ngIf="errors.programa_educativo">{{ errors.programa_educativo }}</div>
        </div>
      </div>

      <mat-form-field class="w-100" appearance="fill">
        <mat-label>Descripción breve</mat-label>
        <textarea matInput [(ngModel)]="evento.descripcion" (keypress)="validarDescripcion($event)" rows="3"
          maxlength="300"></textarea>
        <mat-hint align="end">{{ evento.descripcion?.length || 0 }}/300</mat-hint>
      </mat-form-field>
      <div class="error-msg" *ngIf="errors.descripcion">{{ errors.descripcion }}</div>

      <div class="d-flex justify-content-end mt-4">
        <button *ngIf="!editar" class="btn-primary-custom" mat-flat-button (click)="registrar()">
          REGISTRAR EVENTO
        </button>
        <button *ngIf="editar" class="btn-primary-custom" mat-flat-button (click)="actualizar()">
          GUARDAR CAMBIOS
        </button>
      </div>

    </div>
  </div>
</div>
